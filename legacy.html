<html>
<head>
  <script src=" https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js "></script>
</head>
<body>
  <div class="chart-container">
    <canvas id="matrix-chart">
  </div>
  <script type="text/javascript" src="results.js"></script>
  <script>
    (async () => {
      let data_processed = []
      for (const [context_length,tests] of Object.entries(DATA.results)) {
        for (const test of tests) {
          data_processed.push({x: parseInt(context_length), y: parseInt(test.insertion_depth), r: 10, ...test})
        }
      }

      const data = {
        datasets: [{
          data: data_processed,
          backgroundColor(context) {
            const {pass,fail} = context.dataset.data[context.dataIndex];
            console.log(context.dataset.data[context.dataIndex])
            if(fail < pass) {
              return 'rgb(0,255,0)'
            }
            return 'rgb(255,0,0)'
          }
        }]
      };

      const axis = {
        offset: true,
        ticks: {
          stepSize: 1024
        }
      }

      const config = {
        type: 'bubble',
        data: data,
        options: {
          events: [],
          borderWidth: 0,
          responsive: true,
          scales: {
            x: {
              ...axis,
              title: {
                display: true,
                text: "Context Length"
              }
            },
            y: {
              ...axis,
              title: {
                display: true,
                text: "Inserted Depth"
              }
            }
          },
          plugins: {
            legend: false,
            title: {
              display: true,
              text: `Needle Test - ${DATA.model} - ${DATA.context} context - ${DATA.needle_attempts} needle attempt(s) - ${DATA.temperature !== undefined ? DATA.temperature : 1} temp - https://github.com/lucyknada/detective-needle-llm`
            }
          }
        },
      };

      const chart = new Chart('matrix-chart', config);
    })()
  </script>
</body>